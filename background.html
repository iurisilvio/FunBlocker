<html>
<head>
    <script>
    var default_config = {
        bad_profiles: [
            'PiadasFail', 'HumorNoFace', 'Jo Suado',
            'paniconainternet', 'OMelhorPanico', 'trustmestore',
            'Humormetal', 'Humordido', 'EngenhariaFacts',
            'O Melhor Do Mundo', 'RisosNoFace',
            '9gag.com' // sorry!
        ]
    }
    // Store a default value for bad_profiles.
    if (localStorage.bad_profiles == undefined) {
        localStorage.bad_profiles = JSON.stringify(default_config.bad_profiles);
    }
    setInterval(function() {
        chrome.tabs.getSelected(null, function(tab) {
            if (tab.url.indexOf("www.facebook.com") != -1) {
                chrome.tabs.executeScript(null, {code: "funblocker()"});
            }
        })
    }, 1000);
    chrome.extension.onRequest.addListener(function(request, sender, callback) {
        if (request.command == "bad_profiles") {
            callback(localStorage.bad_profiles);
        }
    });

    var id = chrome.contextMenus.create({
        "title": "FunBlocker this",
        "contexts": ["link", "selection"],
        "onclick": function(info, tabs) {
            var data = (info.selectionText || info.linkUrl).split("/");
            var tip = data[data.length - 1];
            var word = prompt("Adicione essa palavra no FunBlocker", tip);
            if (word) {
                var bad_profiles = localStorage.bad_profiles ? JSON.parse(localStorage.bad_profiles) : undefined;
                bad_profiles.push(word);
                localStorage[key] = JSON.stringify(value);
            }
        },
        "documentUrlPatterns": ["*://www.facebook.com/*"]
    });
    </script>
</head>
<body></body>
</html>