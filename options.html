<html>
<head>
<link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.4.0/bootstrap.min.css">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>
    function load_profiles() {
        var bad_profiles = localStorage.bad_profiles;
        return bad_profiles ? JSON.parse(bad_profiles) : [];
    }

    function save_profiles(profiles) {
        localStorage.bad_profiles = JSON.stringify(profiles);
    }

    function add_profile(value) {
        var profiles = load_profiles();
        // Check if profile is not already blocked.
        if (profiles.indexOf(value) != -1) {
            return;
        }
        profiles.push(value);
        save_profiles(profiles);
        $("#profiles").append(line_template(value));
        $("#new_profile").val("").focus();
    }
    function remove_profile(value) {
        var profiles = load_profiles();
        var index = profiles.indexOf(value);
        if (index != -1) {
            profiles.splice(index, 1);
            save_profiles(profiles);
            $("#profiles td").filter(function() {
                return $(this).text() == value;
            }).parent("tr").remove();
            $("#new_profile").val("").focus();
        }
    }

    function line_template(value) {
        return "<tr><td>" + value + "</td><td style='text-align:right;'><a onclick='remove_profile(\"" + value + "\")' class='btn small' style='padding-top:2px;padding-bottom:2px;'>Remove</a></td></tr>"
    }

    $(document).ready(function() {
        $("#new_profile").keypress(function(e) {
            if ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13)) {
                $("#add_new_profile").click();
                return false;
            }
            else {
                return true;
            }
        });
        var profiles = load_profiles();
        var result = "";
        for (var i = 0; i < profiles.length; i++) {
            result += line_template(profiles[i]);
        };
        $("#profiles").append(result);
    });
</script>
</head>
<body>
    <h1>FunBlocker</h1>
    <h2>Perfis bloqueados</h2>
    <input type="text" id="new_profile" style="height:30px;">
    <span class="span1">
    <a id="add_new_profile" class="btn primary" onclick="javascript:add_profile($('#new_profile').val())">Add</a>
    </span>
    <table id="profiles" class="zebra-striped condensed-table" style="width:300px">
    </table>
</body>
</html>